---
title: "ACLED API"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{acled_api}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning=F, message=F,
  cache = F
)
```


`acled_api()` is a wrapper to request and process ACLED API calls. The function takes the following parameters:

```{r, eval = F}
acled_api(
  email,
  key,
  countries = NULL,
  regions = NULL,
  start_date = NULL,
  end_date = NULL,
  monadic = FALSE
)
```

The email and key must be those associated with your ACLED account registered at developer.acleddata.com. These can be passed as character strings, though I recommend storing them as an environmental variable so you can call them without pasting every session (and for security reasons). To do so, run:
```{r, eval = F}
file.edit(file.path("~", ".Renviron"))
```
which will open your `.Renviron` file. Once there, set:
```{r, eval = F}
Sys.setenv(email_address = "YourEmail")
Sys.setenv(acled_key = "YourKey")
```
and save the file. If you run `Sys.getenv("email_address")`, your associated email will print; if you run `Sys.getenv("acled_key")`, your ACLED key will print. 

The `countries` and `regions` parameters specify where in the world to pull data from. If both are NULL (the default), the API will return data for all countries available. Specific countries may be requested via a vector of country names. Similarly, entire regions may be requested via a vector of region names or numeric codes. `acledR::acled_countries` and `acledR::acled_regions` shows the full lists of countries and regions available. If you specify both countries and regions, the call will return only cases that fit both arguments. For example, if you request `countries = c("Nigeria", "Mexico")` and `regions = c("Western Africa")`, only Nigeria will be returned since Mexico is not in Western Africa. 

The `start_date` and `end_date` parameters specify the time period requested in "yyyy-mm-dd" format. If NULL, all available time periods available will be returned. If either start or end date is NULL, both must be NULL or an error is returned. 

`monadic` is a logical parameter, which is FALSE by default and returns the dyadic version of the data. If set to TRUE, the monadic version will be returned. 

To see how this works in practice, here's an example calling just Brazil since January 2022. Note that I call my email and key directly with `Sys.getenv()` rather than pasting. 



```{r}
library(acledR)
df_br <- acled_api(email = Sys.getenv("email_address"),
                   key = Sys.getenv("acled_key"),
                   countries = c("Brazil"),
                   start_date = "2022-01-01",
                   end_date = "2022-05-09",
                   monadic = F)
```

The results return a tibble with each ACLED event in Brazil during this time period:

```{r}
df_br %>% 
  dplyr::glimpse()
```



If instead we wanted multiple countries, we could execute:

```{r}
df_br_co <- acled_api(email = Sys.getenv("email_address"),
                      key = Sys.getenv("acled_key"),
                      countries = c("Brazil", "Colombia"),
                      start_date = "2022-01-01",
                      end_date = "2022-05-09",
                      monadic = F)
```

For an entire region, we omit the `countries` parameter and supply a `regions` argument:

```{r}
df_sa <- acled_api(email = Sys.getenv("email_address"),
                   key = Sys.getenv("acled_key"),
                   regions = c("South America"),
                   start_date = "2022-01-01",
                   end_date = "2022-04-30",
                   monadic = F)
```


We could also request the monadic version of the data by setting `monadic = TRUE`:

```{r}
df_sa_monadic <- acled_api(email = Sys.getenv("email_address"),
                           key = Sys.getenv("acled_key"),
                           regions = c("South America"),
                           start_date = "2022-01-01",
                           end_date = "2022-04-30",
                           monadic = T)
```

In both the dyadic and monadic versions, the API returns `r length(unique(df_sa$event_id_cnty))` unique events. However, the number of unique entries for the dyadic version is also `r length(df_sa$event_id_cnty)`, while it's `r length(df_sa_monadic$event_id_cnty)` for the monadic version.


